<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cloudflare Snippets</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #38bdf8;
            --light-bg: #0c0a09;
            --content-bg: rgba(23, 23, 23, 0.5);
            --border-color: rgba(255, 255, 255, 0.15);
            --text-color: #f2f2f2;
            --text-light: #a3a3a3;
            --font-family-sans: 'Inter', 'Noto Sans SC', sans-serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { font-size: 16px; }
        body { font-family: var(--font-family-sans); background-color: var(--light-bg); color: var(--text-color); line-height: 1.65; overflow-x: hidden; padding: 0; position: relative; transition: background-color .5s ease; background-size: cover; background-position: center; background-attachment: fixed; }
        body::before { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; background: radial-gradient(at 27% 37%, hsla(215, 98%, 61%, .4) 0px, transparent 50%), radial-gradient(at 97% 21%, hsla(125, 98%, 72%, .2) 0px, transparent 50%), radial-gradient(at 52% 99%, hsla(355, 98%, 76%, .3) 0px, transparent 50%), radial-gradient(at 10% 29%, hsla(256, 96%, 68%, .3) 0px, transparent 50%), radial-gradient(at 97% 96%, hsla(38, 60%, 74%, .2) 0px, transparent 50%), radial-gradient(at 33% 50%, hsla(222, 67%, 73%, .3) 0px, transparent 50%), radial-gradient(at 79% 53%, hsla(343, 68%, 73%, .2) 0px, transparent 50%); animation: auroraBG 20s ease-in-out infinite alternate; }
        @keyframes auroraBG { from { transform: scale(1); } to { transform: scale(1.5); } }
        .app-container { max-width: 1100px; margin: 0 auto; padding: 0 1rem; position: relative; z-index: 1; }
        header { text-align: center; margin-top: 2rem; margin-bottom: 2rem; }
        header h1 { font-size: 2.25em; color: var(--primary-color); font-weight: 700; text-shadow: 0 0 10px rgba(56, 189, 248, 0.3); }
        .card { background-color: rgba(23, 23, 23, 0.6); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-radius: 12px; box-shadow: 0 3px 8px rgba(0, 0, 0, .25); padding: 1.5rem; margin-bottom: 1.5rem; border: 1px solid var(--border-color); }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: .75rem; border-bottom: 1px solid var(--border-color); }
        .section-header h2 { font-size: 1.6em; font-weight: 600; margin: 0; }
        .btn { display: inline-flex; align-items: center; justify-content: center; font-weight: 500; text-align: center; cursor: pointer; user-select: none; background: rgba(56, 189, 248, 0.2); border: 1px solid var(--primary-color); color: var(--primary-color); padding: .5em 1em; font-size: 1em; border-radius: 8px; transition: all .2s ease-in-out; }
        .btn:hover { background-color: var(--primary-color); color: #fff; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(56, 189, 248, 0.2); }
        .app-download-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; }
        .app-download-buttons .btn { width: 100%; margin: 0; }
        #appModal { display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, .6); justify-content: center; align-items: center; backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); }
        .app-modal-content { background-color: var(--content-bg); padding: 2rem; border: 1px solid var(--border-color); border-radius: 12px; width: 95%; max-width: 800px; max-height: 90vh; overflow-y: auto; box-shadow: 0 5px 15px rgba(0, 0, 0, .3); }
        .app-modal-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 1rem; margin-bottom: 1rem; border-bottom: 1px solid var(--border-color); }
        .app-modal-header h3 { margin: 0; color: var(--primary-color); }
        .modal-close-btn { font-size: 1.5rem; font-weight: 700; line-height: 1; color: var(--text-light); cursor: pointer; background: none; border: none; padding: 0; }
        .app-list-item { display: flex; flex-direction: column; padding: 1rem; border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 1rem; }
        .app-name { font-size: 1.1em; font-weight: 600; }
        .app-links a { display: block; color: var(--primary-color); text-decoration: none; margin-top: .5rem; word-break: break-all; }
        .app-links a:hover { text-decoration: underline; }
        .app-links span { color: var(--text-light); }
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .app-container { padding: 0 .8rem; }
            header { margin-top: 2.5rem; margin-bottom: 1.5rem; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <h1>Cloudflare Snippets</h1>
        </header>
        <div class="card app-download-section">
            <div class="section-header">
                <h2>APP 下载</h2>
            </div>
            <div class="app-download-buttons">
                <button class="btn" data-platform="android">安卓</button>
                <button class="btn" data-platform="windows">Windows</button>
                <button class="btn" data-platform="mac">Mac</button>
                <button class="btn" data-platform="ios">苹果</button>
            </div>
        </div>
    </div>

    <div id="appModal">
        <div class="app-modal-content">
            <div class="app-modal-header">
                <h3 id="appModalTitle"></h3>
                <button class="modal-close-btn">×</button>
            </div>
            <div class="app-modal-body" id="appModalBody"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const appButtons = document.querySelectorAll('.app-download-section .btn');
            const appModal = document.getElementById('appModal');
            const baseUrl = window.location.origin;

            const downloadData = {
                android: [
                    { name: 'Clash Meta', repo: 'MetaCubeX/Clash-Meta-for-Android', keywords: ['apk', 'universal'] },
                    { name: 'Karing', repo: 'KaringX/karing', keywords: ['apk', 'universal-release'] },
                    { name: 'Sing-Box', repo: 'SagerNet/sing-box', keywords: ['android', 'universal'] },
                    { name: 'V2rayNG', repo: '2dust/v2rayNG', keywords: ['apk', 'arm64-v8a'] }
                ],
                ios: [
                    { name: 'Shadowrocket', fixedUrl: 'https://apps.apple.com/us/app/shadowrocket/id932747118' },
                    { name: 'Sing-Box', fixedUrl: 'https://apps.apple.com/us/app/sing-box-vt/id6673731168' }
                ],
                windows: [
                    { name: 'V2rayN', fixedUrl: 'https://github.com/2dust/v2rayN/releases/download/7.12.4/v2rayN-windows-64-SelfContained.zip' },
                    { name: 'ClashN', repo: '2dust/clashN', keywords: ['clashN.zip'] }
                ],
                mac: [
                    { name: 'ClashX', fixedUrl: 'https://github.com/yichengchen/clashX/releases/download/1.118.1/ClashX.dmg' }
                ]
            };

            function getAcceleratedUrl(url) {
                if (url.includes('github.com')) {
                    return baseUrl + '/' + url.replace('://', ':/');
                }
                return url;
            }

            async function getLatestReleaseAsset(repo, keywords) {
                try {
                    const response = await fetch(getAcceleratedUrl(`https://api.github.com/repos/${repo}/releases/latest`));
                    if (!response.ok) return null;
                    const data = await response.json();
                    for (const keyword of keywords) {
                        const asset = data.assets.find(a => a.name.toLowerCase().includes(keyword.toLowerCase()));
                        if (asset) return asset.browser_download_url;
                    }
                    return data.assets[0] ? data.assets[0].browser_download_url : null;
                } catch (e) {
                    return null;
                }
            }

            async function openAppModal(platform) {
                const platformName = { android: '安卓', ios: '苹果', windows: 'Windows', mac: 'Mac' }[platform];
                appModal.querySelector('#appModalTitle').textContent = `${platformName}客户端下载`;
                const modalBody = appModal.querySelector('#appModalBody');
                modalBody.innerHTML = '<p>正在获取最新版本...</p>';
                appModal.style.display = 'flex';
                const apps = downloadData[platform];
                let content = '';
                for (const app of apps) {
                    let linksHtml = '';
                    if (app.fixedUrl) {
                        linksHtml = `<a href="${getAcceleratedUrl(app.fixedUrl)}" target="_blank" rel="noopener noreferrer">${app.fixedUrl.split('/').pop()}</a>`;
                    } else if (app.repo) {
                        const url = await getLatestReleaseAsset(app.repo, app.keywords);
                        linksHtml = url ? `<a href="${getAcceleratedUrl(url)}" target="_blank" rel="noopener noreferrer">${url.split('/').pop()}</a>` : '<span>获取失败</span>';
                    }
                    content += `<div class="app-list-item"><span class="app-name">${app.name}</span><div class="app-links">${linksHtml}</div></div>`;
                }
                modalBody.innerHTML = content;
            }

            appButtons.forEach(button => {
                button.addEventListener('click', () => openAppModal(button.dataset.platform));
            });

            if (appModal) {
                appModal.querySelector('.modal-close-btn').addEventListener('click', () => { appModal.style.display = 'none'; });
                appModal.addEventListener('click', e => { if (e.target === appModal) appModal.style.display = 'none'; });
            }
        });
    </script>
</body>
</html>
